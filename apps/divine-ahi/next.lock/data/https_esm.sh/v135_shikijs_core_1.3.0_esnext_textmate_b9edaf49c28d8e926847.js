/* esm.sh - esbuild bundle(@shikijs/core@1.3.0/textmate) esnext production */
import __Process$ from "/v135/node_process.js";
import{FontStyle as Te}from"/v135/@shikijs/core@1.3.0/esnext/dist/types.js";typeof __Process$<"u"&&__Process$.env.VSCODE_TEXTMATE_DEBUG;var k;(function(r){function e(h){return h.toString(2).padStart(32,"0")}r.toBinaryStr=e;function t(h){let u=r.getLanguageId(h),f=r.getTokenType(h),d=r.getFontStyle(h),p=r.getForeground(h),S=r.getBackground(h);console.log({languageId:u,tokenType:f,fontStyle:d,foreground:p,background:S})}r.print=t;function s(h){return(h&255)>>>0}r.getLanguageId=s;function n(h){return(h&768)>>>8}r.getTokenType=n;function i(h){return(h&1024)!==0}r.containsBalancedBrackets=i;function a(h){return(h&30720)>>>11}r.getFontStyle=a;function l(h){return(h&16744448)>>>15}r.getForeground=l;function o(h){return(h&4278190080)>>>24}r.getBackground=o;function c(h,u,f,d,p,S,_){let C=r.getLanguageId(h),g=r.getTokenType(h),w=r.containsBalancedBrackets(h)?1:0,y=r.getFontStyle(h),R=r.getForeground(h),G=r.getBackground(h);return u!==0&&(C=u),f!==8&&(g=f),d!==null&&(w=d?1:0),p!==-1&&(y=p),S!==0&&(R=S),_!==0&&(G=_),(C<<0|g<<8|w<<10|y<<11|R<<15|G<<24)>>>0}r.set=c})(k||(k={}));function $(r,e){let t=[],s=Me(r),n=s.next();for(;n!==null;){let o=0;if(n.length===2&&n.charAt(1)===":"){switch(n.charAt(0)){case"R":o=1;break;case"L":o=-1;break;default:console.log(`Unknown priority ${n} in scope selector`)}n=s.next()}let c=a();if(t.push({matcher:c,priority:o}),n!==",")break;n=s.next()}return t;function i(){if(n==="-"){n=s.next();let o=i();return c=>!!o&&!o(c)}if(n==="("){n=s.next();let o=l();return n===")"&&(n=s.next()),o}if(Ce(n)){let o=[];do o.push(n),n=s.next();while(Ce(n));return c=>e(o,c)}return null}function a(){let o=[],c=i();for(;c;)o.push(c),c=i();return h=>o.every(u=>u(h))}function l(){let o=[],c=a();for(;c&&(o.push(c),n==="|"||n===",");){do n=s.next();while(n==="|"||n===",");c=a()}return h=>o.some(u=>u(h))}}function Ce(r){return!!r&&!!r.match(/[\w\.:]+/)}function Me(r){let e=/([LR]:|[\w\.:][\w\.:\-]*|[\,\|\-\(\)])/g,t=e.exec(r);return{next:()=>{if(!t)return null;let s=t[0];return t=e.exec(r),s}}}function Pe(r){typeof r.dispose=="function"&&r.dispose()}function xe(r){return Se(r)}function Se(r){return Array.isArray(r)?ve(r):typeof r=="object"?je(r):r}function ve(r){let e=[];for(let t=0,s=r.length;t<s;t++)e[t]=Se(r[t]);return e}function je(r){let e={};for(let t in r)e[t]=Se(r[t]);return e}function Ne(r,...e){return e.forEach(t=>{for(let s in t)r[s]=t[s]}),r}function be(r){let e=~r.lastIndexOf("/")||~r.lastIndexOf("\\");return e===0?r:~e===r.length-1?be(r.substring(0,r.length-1)):r.substr(~e+1)}var X=/\$(\d+)|\${(\d+):\/(downcase|upcase)}/g,E=class{static hasCaptures(e){return e===null?!1:(X.lastIndex=0,X.test(e))}static replaceCaptures(e,t,s){return e.replace(X,(n,i,a,l)=>{let o=s[parseInt(i||a,10)];if(o){let c=t.substring(o.start,o.end);for(;c[0]===".";)c=c.substring(1);switch(l){case"downcase":return c.toLowerCase();case"upcase":return c.toUpperCase();default:return c}}else return n})}};function Ge(r,e){return r<e?-1:r>e?1:0}function Ee(r,e){if(r===null&&e===null)return 0;if(!r)return-1;if(!e)return 1;let t=r.length,s=e.length;if(t===s){for(let n=0;n<t;n++){let i=Ge(r[n],e[n]);if(i!==0)return i}return 0}return t-s}function Re(r){return!!(/^#[0-9a-f]{6}$/i.test(r)||/^#[0-9a-f]{8}$/i.test(r)||/^#[0-9a-f]{3}$/i.test(r)||/^#[0-9a-f]{4}$/i.test(r))}function ke(r){return r.replace(/[\-\\\{\}\*\+\?\|\^\$\.\,\[\]\(\)\#\s]/g,"\\$&")}var D=class{fn;cache=new Map;constructor(e){this.fn=e}get(e){if(this.cache.has(e))return this.cache.get(e);let t=this.fn(e);return this.cache.set(e,t),t}},I=class{scopeName;constructor(e){this.scopeName=e}toKey(){return this.scopeName}},V=class{scopeName;ruleName;constructor(e,t){this.scopeName=e,this.ruleName=t}toKey(){return`${this.scopeName}#${this.ruleName}`}},J=class{_references=[];_seenReferenceKeys=new Set;get references(){return this._references}visitedRule=new Set;add(e){let t=e.toKey();this._seenReferenceKeys.has(t)||(this._seenReferenceKeys.add(t),this._references.push(e))}},Z=class{repo;initialScopeName;seenFullScopeRequests=new Set;seenPartialScopeRequests=new Set;Q;constructor(e,t){this.repo=e,this.initialScopeName=t,this.seenFullScopeRequests.add(this.initialScopeName),this.Q=[new I(this.initialScopeName)]}processQueue(){let e=this.Q;this.Q=[];let t=new J;for(let s of e)$e(s,this.initialScopeName,this.repo,t);for(let s of t.references)if(s instanceof I){if(this.seenFullScopeRequests.has(s.scopeName))continue;this.seenFullScopeRequests.add(s.scopeName),this.Q.push(s)}else{if(this.seenFullScopeRequests.has(s.scopeName)||this.seenPartialScopeRequests.has(s.toKey()))continue;this.seenPartialScopeRequests.add(s.toKey()),this.Q.push(s)}}};function $e(r,e,t,s){let n=t.lookup(r.scopeName);if(!n){if(r.scopeName===e)throw new Error(`No grammar provided for <${e}>`);return}let i=t.lookup(e);r instanceof I?j({baseGrammar:i,selfGrammar:n},s):ee(r.ruleName,{baseGrammar:i,selfGrammar:n,repository:n.repository},s);let a=t.injections(r.scopeName);if(a)for(let l of a)s.add(new I(l))}function ee(r,e,t){if(e.repository&&e.repository[r]){let s=e.repository[r];W([s],e,t)}}function j(r,e){r.selfGrammar.patterns&&Array.isArray(r.selfGrammar.patterns)&&W(r.selfGrammar.patterns,{...r,repository:r.selfGrammar.repository},e),r.selfGrammar.injections&&W(Object.values(r.selfGrammar.injections),{...r,repository:r.selfGrammar.repository},e)}function W(r,e,t){for(let s of r){if(t.visitedRule.has(s))continue;t.visitedRule.add(s);let n=s.repository?Ne({},e.repository,s.repository):e.repository;Array.isArray(s.patterns)&&W(s.patterns,{...e,repository:n},t);let i=s.include;if(!i)continue;let a=Fe(i);switch(a.kind){case 0:j({...e,selfGrammar:e.baseGrammar},t);break;case 1:j(e,t);break;case 2:ee(a.ruleName,{...e,repository:n},t);break;case 3:case 4:let l=a.scopeName===e.selfGrammar.scopeName?e.selfGrammar:a.scopeName===e.baseGrammar.scopeName?e.baseGrammar:void 0;if(l){let o={baseGrammar:e.baseGrammar,selfGrammar:l,repository:n};a.kind===4?ee(a.ruleName,o,t):j(o,t)}else a.kind===4?t.add(new V(a.scopeName,a.ruleName)):t.add(new I(a.scopeName));break}}}var te=class{kind=0},se=class{kind=1},ne=class{ruleName;kind=2;constructor(e){this.ruleName=e}},re=class{scopeName;kind=3;constructor(e){this.scopeName=e}},ie=class{scopeName;ruleName;kind=4;constructor(e,t){this.scopeName=e,this.ruleName=t}};function Fe(r){if(r==="$base")return new te;if(r==="$self")return new se;let e=r.indexOf("#");if(e===-1)return new re(r);if(e===0)return new ne(r.substring(1));{let t=r.substring(0,e),s=r.substring(e+1);return new ie(t,s)}}var De=/\\(\d+)/,ye=/\\(\d+)/g,We=-1,Le=-2;var P=class{$location;id;_nameIsCapturing;_name;_contentNameIsCapturing;_contentName;constructor(e,t,s,n){this.$location=e,this.id=t,this._name=s||null,this._nameIsCapturing=E.hasCaptures(this._name),this._contentName=n||null,this._contentNameIsCapturing=E.hasCaptures(this._contentName)}get debugName(){let e=this.$location?`${be(this.$location.filename)}:${this.$location.line}`:"unknown";return`${this.constructor.name}#${this.id} @ ${e}`}getName(e,t){return!this._nameIsCapturing||this._name===null||e===null||t===null?this._name:E.replaceCaptures(this._name,e,t)}getContentName(e,t){return!this._contentNameIsCapturing||this._contentName===null?this._contentName:E.replaceCaptures(this._contentName,e,t)}},oe=class extends P{retokenizeCapturedWithRuleId;constructor(e,t,s,n,i){super(e,t,s,n),this.retokenizeCapturedWithRuleId=i}dispose(){}collectPatterns(e,t){throw new Error("Not supported!")}compile(e,t){throw new Error("Not supported!")}compileAG(e,t,s,n){throw new Error("Not supported!")}},ae=class extends P{_match;captures;_cachedCompiledPatterns;constructor(e,t,s,n,i){super(e,t,s,null),this._match=new N(n,this.id),this.captures=i,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugMatchRegExp(){return`${this._match.source}`}collectPatterns(e,t){t.push(this._match)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,s,n){return this._getCachedCompiledPatterns(e).compileAG(e,s,n)}_getCachedCompiledPatterns(e){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new b,this.collectPatterns(e,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},K=class extends P{hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(e,t,s,n,i){super(e,t,s,n),this.patterns=i.patterns,this.hasMissingPatterns=i.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}collectPatterns(e,t){for(let s of this.patterns)e.getRule(s).collectPatterns(e,t)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,s,n){return this._getCachedCompiledPatterns(e).compileAG(e,s,n)}_getCachedCompiledPatterns(e){return this._cachedCompiledPatterns||(this._cachedCompiledPatterns=new b,this.collectPatterns(e,this._cachedCompiledPatterns)),this._cachedCompiledPatterns}},T=class extends P{_begin;beginCaptures;_end;endHasBackReferences;endCaptures;applyEndPatternLast;hasMissingPatterns;patterns;_cachedCompiledPatterns;constructor(e,t,s,n,i,a,l,o,c,h){super(e,t,s,n),this._begin=new N(i,this.id),this.beginCaptures=a,this._end=new N(l||"\uFFFF",-1),this.endHasBackReferences=this._end.hasBackReferences,this.endCaptures=o,this.applyEndPatternLast=c||!1,this.patterns=h.patterns,this.hasMissingPatterns=h.hasMissingPatterns,this._cachedCompiledPatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugEndRegExp(){return`${this._end.source}`}getEndWithResolvedBackReferences(e,t){return this._end.resolveBackReferences(e,t)}collectPatterns(e,t){t.push(this._begin)}compile(e,t){return this._getCachedCompiledPatterns(e,t).compile(e)}compileAG(e,t,s,n){return this._getCachedCompiledPatterns(e,t).compileAG(e,s,n)}_getCachedCompiledPatterns(e,t){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new b;for(let s of this.patterns)e.getRule(s).collectPatterns(e,this._cachedCompiledPatterns);this.applyEndPatternLast?this._cachedCompiledPatterns.push(this._end.hasBackReferences?this._end.clone():this._end):this._cachedCompiledPatterns.unshift(this._end.hasBackReferences?this._end.clone():this._end)}return this._end.hasBackReferences&&(this.applyEndPatternLast?this._cachedCompiledPatterns.setSource(this._cachedCompiledPatterns.length()-1,t):this._cachedCompiledPatterns.setSource(0,t)),this._cachedCompiledPatterns}},F=class extends P{_begin;beginCaptures;whileCaptures;_while;whileHasBackReferences;hasMissingPatterns;patterns;_cachedCompiledPatterns;_cachedCompiledWhilePatterns;constructor(e,t,s,n,i,a,l,o,c){super(e,t,s,n),this._begin=new N(i,this.id),this.beginCaptures=a,this.whileCaptures=o,this._while=new N(l,Le),this.whileHasBackReferences=this._while.hasBackReferences,this.patterns=c.patterns,this.hasMissingPatterns=c.hasMissingPatterns,this._cachedCompiledPatterns=null,this._cachedCompiledWhilePatterns=null}dispose(){this._cachedCompiledPatterns&&(this._cachedCompiledPatterns.dispose(),this._cachedCompiledPatterns=null),this._cachedCompiledWhilePatterns&&(this._cachedCompiledWhilePatterns.dispose(),this._cachedCompiledWhilePatterns=null)}get debugBeginRegExp(){return`${this._begin.source}`}get debugWhileRegExp(){return`${this._while.source}`}getWhileWithResolvedBackReferences(e,t){return this._while.resolveBackReferences(e,t)}collectPatterns(e,t){t.push(this._begin)}compile(e,t){return this._getCachedCompiledPatterns(e).compile(e)}compileAG(e,t,s,n){return this._getCachedCompiledPatterns(e).compileAG(e,s,n)}_getCachedCompiledPatterns(e){if(!this._cachedCompiledPatterns){this._cachedCompiledPatterns=new b;for(let t of this.patterns)e.getRule(t).collectPatterns(e,this._cachedCompiledPatterns)}return this._cachedCompiledPatterns}compileWhile(e,t){return this._getCachedCompiledWhilePatterns(e,t).compile(e)}compileWhileAG(e,t,s,n){return this._getCachedCompiledWhilePatterns(e,t).compileAG(e,s,n)}_getCachedCompiledWhilePatterns(e,t){return this._cachedCompiledWhilePatterns||(this._cachedCompiledWhilePatterns=new b,this._cachedCompiledWhilePatterns.push(this._while.hasBackReferences?this._while.clone():this._while)),this._while.hasBackReferences&&this._cachedCompiledWhilePatterns.setSource(0,t||"\uFFFF"),this._cachedCompiledWhilePatterns}},U=class r{static createCaptureRule(e,t,s,n,i){return e.registerRule(a=>new oe(t,a,s,n,i))}static getCompiledRuleId(e,t,s){return e.id||t.registerRule(n=>{if(e.id=n,e.match)return new ae(e.$vscodeTextmateLocation,e.id,e.name,e.match,r._compileCaptures(e.captures,t,s));if(typeof e.begin>"u"){e.repository&&(s=Ne({},s,e.repository));let i=e.patterns;return typeof i>"u"&&e.include&&(i=[{include:e.include}]),new K(e.$vscodeTextmateLocation,e.id,e.name,e.contentName,r._compilePatterns(i,t,s))}return e.while?new F(e.$vscodeTextmateLocation,e.id,e.name,e.contentName,e.begin,r._compileCaptures(e.beginCaptures||e.captures,t,s),e.while,r._compileCaptures(e.whileCaptures||e.captures,t,s),r._compilePatterns(e.patterns,t,s)):new T(e.$vscodeTextmateLocation,e.id,e.name,e.contentName,e.begin,r._compileCaptures(e.beginCaptures||e.captures,t,s),e.end,r._compileCaptures(e.endCaptures||e.captures,t,s),e.applyEndPatternLast,r._compilePatterns(e.patterns,t,s))}),e.id}static _compileCaptures(e,t,s){let n=[];if(e){let i=0;for(let a in e){if(a==="$vscodeTextmateLocation")continue;let l=parseInt(a,10);l>i&&(i=l)}for(let a=0;a<=i;a++)n[a]=null;for(let a in e){if(a==="$vscodeTextmateLocation")continue;let l=parseInt(a,10),o=0;e[a].patterns&&(o=r.getCompiledRuleId(e[a],t,s)),n[l]=r.createCaptureRule(t,e[a].$vscodeTextmateLocation,e[a].name,e[a].contentName,o)}}return n}static _compilePatterns(e,t,s){let n=[];if(e)for(let i=0,a=e.length;i<a;i++){let l=e[i],o=-1;if(l.include){let c=Fe(l.include);switch(c.kind){case 0:case 1:o=r.getCompiledRuleId(s[l.include],t,s);break;case 2:let h=s[c.ruleName];h&&(o=r.getCompiledRuleId(h,t,s));break;case 3:case 4:let u=c.scopeName,f=c.kind===4?c.ruleName:null,d=t.getExternalGrammar(u,s);if(d)if(f){let p=d.repository[f];p&&(o=r.getCompiledRuleId(p,t,d.repository))}else o=r.getCompiledRuleId(d.repository.$self,t,d.repository);break}}else o=r.getCompiledRuleId(l,t,s);if(o!==-1){let c=t.getRule(o),h=!1;if((c instanceof K||c instanceof T||c instanceof F)&&c.hasMissingPatterns&&c.patterns.length===0&&(h=!0),h)continue;n.push(o)}}return{patterns:n,hasMissingPatterns:(e?e.length:0)!==n.length}}},N=class r{source;ruleId;hasAnchor;hasBackReferences;_anchorCache;constructor(e,t){if(e){let s=e.length,n=0,i=[],a=!1;for(let l=0;l<s;l++)if(e.charAt(l)==="\\"&&l+1<s){let c=e.charAt(l+1);c==="z"?(i.push(e.substring(n,l)),i.push("$(?!\\n)(?<!\\n)"),n=l+2):(c==="A"||c==="G")&&(a=!0),l++}this.hasAnchor=a,n===0?this.source=e:(i.push(e.substring(n,s)),this.source=i.join(""))}else this.hasAnchor=!1,this.source=e;this.hasAnchor?this._anchorCache=this._buildAnchorCache():this._anchorCache=null,this.ruleId=t,this.hasBackReferences=De.test(this.source)}clone(){return new r(this.source,this.ruleId)}setSource(e){this.source!==e&&(this.source=e,this.hasAnchor&&(this._anchorCache=this._buildAnchorCache()))}resolveBackReferences(e,t){let s=t.map(n=>e.substring(n.start,n.end));return ye.lastIndex=0,this.source.replace(ye,(n,i)=>ke(s[parseInt(i,10)]||""))}_buildAnchorCache(){let e=[],t=[],s=[],n=[],i,a,l,o;for(i=0,a=this.source.length;i<a;i++)l=this.source.charAt(i),e[i]=l,t[i]=l,s[i]=l,n[i]=l,l==="\\"&&i+1<a&&(o=this.source.charAt(i+1),o==="A"?(e[i+1]="\uFFFF",t[i+1]="\uFFFF",s[i+1]="A",n[i+1]="A"):o==="G"?(e[i+1]="\uFFFF",t[i+1]="G",s[i+1]="\uFFFF",n[i+1]="G"):(e[i+1]=o,t[i+1]=o,s[i+1]=o,n[i+1]=o),i++);return{A0_G0:e.join(""),A0_G1:t.join(""),A1_G0:s.join(""),A1_G1:n.join("")}}resolveAnchors(e,t){return!this.hasAnchor||!this._anchorCache?this.source:e?t?this._anchorCache.A1_G1:this._anchorCache.A1_G0:t?this._anchorCache.A0_G1:this._anchorCache.A0_G0}},b=class{_items;_hasAnchors;_cached;_anchorCache;constructor(){this._items=[],this._hasAnchors=!1,this._cached=null,this._anchorCache={A0_G0:null,A0_G1:null,A1_G0:null,A1_G1:null}}dispose(){this._disposeCaches()}_disposeCaches(){this._cached&&(this._cached.dispose(),this._cached=null),this._anchorCache.A0_G0&&(this._anchorCache.A0_G0.dispose(),this._anchorCache.A0_G0=null),this._anchorCache.A0_G1&&(this._anchorCache.A0_G1.dispose(),this._anchorCache.A0_G1=null),this._anchorCache.A1_G0&&(this._anchorCache.A1_G0.dispose(),this._anchorCache.A1_G0=null),this._anchorCache.A1_G1&&(this._anchorCache.A1_G1.dispose(),this._anchorCache.A1_G1=null)}push(e){this._items.push(e),this._hasAnchors=this._hasAnchors||e.hasAnchor}unshift(e){this._items.unshift(e),this._hasAnchors=this._hasAnchors||e.hasAnchor}length(){return this._items.length}setSource(e,t){this._items[e].source!==t&&(this._disposeCaches(),this._items[e].setSource(t))}compile(e){if(!this._cached){let t=this._items.map(s=>s.source);this._cached=new q(e,t,this._items.map(s=>s.ruleId))}return this._cached}compileAG(e,t,s){return this._hasAnchors?t?s?(this._anchorCache.A1_G1||(this._anchorCache.A1_G1=this._resolveAnchors(e,t,s)),this._anchorCache.A1_G1):(this._anchorCache.A1_G0||(this._anchorCache.A1_G0=this._resolveAnchors(e,t,s)),this._anchorCache.A1_G0):s?(this._anchorCache.A0_G1||(this._anchorCache.A0_G1=this._resolveAnchors(e,t,s)),this._anchorCache.A0_G1):(this._anchorCache.A0_G0||(this._anchorCache.A0_G0=this._resolveAnchors(e,t,s)),this._anchorCache.A0_G0):this.compile(e)}_resolveAnchors(e,t,s){let n=this._items.map(i=>i.resolveAnchors(t,s));return new q(e,n,this._items.map(i=>i.ruleId))}},q=class{regExps;rules;scanner;constructor(e,t,s){this.regExps=t,this.rules=s,this.scanner=e.createOnigScanner(t)}dispose(){typeof this.scanner.dispose=="function"&&this.scanner.dispose()}toString(){let e=[];for(let t=0,s=this.rules.length;t<s;t++)e.push("   - "+this.rules[t]+": "+this.regExps[t]);return e.join(`
`)}findNextMatchSync(e,t,s){let n=this.scanner.findNextMatchSync(e,t,s);return n?{ruleId:this.rules[n.index],captureIndices:n.captureIndices}:null}},M=class{_colorMap;_defaults;_root;static createFromRawTheme(e,t){return this.createFromParsedTheme(qe(e),t)}static createFromParsedTheme(e,t){return ze(e,t)}_cachedMatchRoot=new D(e=>this._root.match(e));constructor(e,t,s){this._colorMap=e,this._defaults=t,this._root=s}getColorMap(){return this._colorMap.getColorMap()}getDefaults(){return this._defaults}match(e){if(e===null)return this._defaults;let t=e.scopeName,n=this._cachedMatchRoot.get(t).find(i=>Ke(e.parent,i.parentScopes));return n?new z(n.fontStyle,n.foreground,n.background):null}},O=class r{parent;scopeName;static push(e,t){for(let s of t)e=new r(e,s);return e}static from(...e){let t=null;for(let s=0;s<e.length;s++)t=new r(t,e[s]);return t}constructor(e,t){this.parent=e,this.scopeName=t}push(e){return new r(this,e)}getSegments(){let e=this,t=[];for(;e;)t.push(e.scopeName),e=e.parent;return t.reverse(),t}toString(){return this.getSegments().join(" ")}extends(e){return this===e?!0:this.parent===null?!1:this.parent.extends(e)}getExtensionIfDefined(e){let t=[],s=this;for(;s&&s!==e;)t.push(s.scopeName),s=s.parent;return s===e?t.reverse():void 0}};function Ke(r,e){if(e===null)return!0;let t=0,s=e[t];for(;r;){if(Ue(r.scopeName,s)){if(t++,t===e.length)return!0;s=e[t]}r=r.parent}return!1}function Ue(r,e){return e===r||r.startsWith(e)&&r[e.length]==="."}var z=class{fontStyle;foregroundId;backgroundId;constructor(e,t,s){this.fontStyle=e,this.foregroundId=t,this.backgroundId=s}};function qe(r){if(!r)return[];if(!r.settings||!Array.isArray(r.settings))return[];let e=r.settings,t=[],s=0;for(let n=0,i=e.length;n<i;n++){let a=e[n];if(!a.settings)continue;let l;if(typeof a.scope=="string"){let u=a.scope;u=u.replace(/^[,]+/,""),u=u.replace(/[,]+$/,""),l=u.split(",")}else Array.isArray(a.scope)?l=a.scope:l=[""];let o=-1;if(typeof a.settings.fontStyle=="string"){o=0;let u=a.settings.fontStyle.split(" ");for(let f=0,d=u.length;f<d;f++)switch(u[f]){case"italic":o=o|1;break;case"bold":o=o|2;break;case"underline":o=o|4;break;case"strikethrough":o=o|8;break}}let c=null;typeof a.settings.foreground=="string"&&Re(a.settings.foreground)&&(c=a.settings.foreground);let h=null;typeof a.settings.background=="string"&&Re(a.settings.background)&&(h=a.settings.background);for(let u=0,f=l.length;u<f;u++){let p=l[u].trim().split(" "),S=p[p.length-1],_=null;p.length>1&&(_=p.slice(0,p.length-1),_.reverse()),t[s++]=new ce(S,_,n,o,c,h)}}return t}var ce=class{scope;parentScopes;index;fontStyle;foreground;background;constructor(e,t,s,n,i,a){this.scope=e,this.parentScopes=t,this.index=s,this.fontStyle=n,this.foreground=i,this.background=a}};function ze(r,e){r.sort((o,c)=>{let h=Ge(o.scope,c.scope);return h!==0||(h=Ee(o.parentScopes,c.parentScopes),h!==0)?h:o.index-c.index});let t=0,s="#000000",n="#ffffff";for(;r.length>=1&&r[0].scope==="";){let o=r.shift();o.fontStyle!==-1&&(t=o.fontStyle),o.foreground!==null&&(s=o.foreground),o.background!==null&&(n=o.background)}let i=new le(e),a=new z(t,i.getId(s),i.getId(n)),l=new he(new x(0,null,-1,0,0),[]);for(let o=0,c=r.length;o<c;o++){let h=r[o];l.insert(0,h.scope,h.parentScopes,h.fontStyle,i.getId(h.foreground),i.getId(h.background))}return new M(i,a,l)}var le=class{_isFrozen;_lastColorId;_id2color;_color2id;constructor(e){if(this._lastColorId=0,this._id2color=[],this._color2id=Object.create(null),Array.isArray(e)){this._isFrozen=!0;for(let t=0,s=e.length;t<s;t++)this._color2id[e[t]]=t,this._id2color[t]=e[t]}else this._isFrozen=!1}getId(e){if(e===null)return 0;e=e.toUpperCase();let t=this._color2id[e];if(t)return t;if(this._isFrozen)throw new Error(`Missing color in color map - ${e}`);return t=++this._lastColorId,this._color2id[e]=t,this._id2color[t]=e,t}getColorMap(){return this._id2color.slice(0)}},x=class r{scopeDepth;parentScopes;fontStyle;foreground;background;constructor(e,t,s,n,i){this.scopeDepth=e,this.parentScopes=t,this.fontStyle=s,this.foreground=n,this.background=i}clone(){return new r(this.scopeDepth,this.parentScopes,this.fontStyle,this.foreground,this.background)}static cloneArr(e){let t=[];for(let s=0,n=e.length;s<n;s++)t[s]=e[s].clone();return t}acceptOverwrite(e,t,s,n){this.scopeDepth>e?console.log("how did this happen?"):this.scopeDepth=e,t!==-1&&(this.fontStyle=t),s!==0&&(this.foreground=s),n!==0&&(this.background=n)}},he=class r{_mainRule;_children;_rulesWithParentScopes;constructor(e,t=[],s={}){this._mainRule=e,this._children=s,this._rulesWithParentScopes=t}static _sortBySpecificity(e){return e.length===1||e.sort(this._cmpBySpecificity),e}static _cmpBySpecificity(e,t){if(e.scopeDepth===t.scopeDepth){let s=e.parentScopes,n=t.parentScopes,i=s===null?0:s.length,a=n===null?0:n.length;if(i===a)for(let l=0;l<i;l++){let o=s[l].length,c=n[l].length;if(o!==c)return c-o}return a-i}return t.scopeDepth-e.scopeDepth}match(e){if(e==="")return r._sortBySpecificity([].concat(this._mainRule).concat(this._rulesWithParentScopes));let t=e.indexOf("."),s,n;return t===-1?(s=e,n=""):(s=e.substring(0,t),n=e.substring(t+1)),this._children.hasOwnProperty(s)?this._children[s].match(n):r._sortBySpecificity([].concat(this._mainRule).concat(this._rulesWithParentScopes))}insert(e,t,s,n,i,a){if(t===""){this._doInsertHere(e,s,n,i,a);return}let l=t.indexOf("."),o,c;l===-1?(o=t,c=""):(o=t.substring(0,l),c=t.substring(l+1));let h;this._children.hasOwnProperty(o)?h=this._children[o]:(h=new r(this._mainRule.clone(),x.cloneArr(this._rulesWithParentScopes)),this._children[o]=h),h.insert(e+1,c,s,n,i,a)}_doInsertHere(e,t,s,n,i){if(t===null){this._mainRule.acceptOverwrite(e,s,n,i);return}for(let a=0,l=this._rulesWithParentScopes.length;a<l;a++){let o=this._rulesWithParentScopes[a];if(Ee(o.parentScopes,t)===0){o.acceptOverwrite(e,s,n,i);return}}s===-1&&(s=this._mainRule.fontStyle),n===0&&(n=this._mainRule.foreground),i===0&&(i=this._mainRule.background),this._rulesWithParentScopes.push(new x(e,t,s,n,i))}},B=class{languageId;tokenType;constructor(e,t){this.languageId=e,this.tokenType=t}},ue=class r{_defaultAttributes;_embeddedLanguagesMatcher;constructor(e,t){this._defaultAttributes=new B(e,8),this._embeddedLanguagesMatcher=new pe(Object.entries(t||{}))}getDefaultAttributes(){return this._defaultAttributes}getBasicScopeAttributes(e){return e===null?r._NULL_SCOPE_METADATA:this._getBasicScopeAttributes.get(e)}static _NULL_SCOPE_METADATA=new B(0,0);_getBasicScopeAttributes=new D(e=>{let t=this._scopeToLanguage(e),s=this._toStandardTokenType(e);return new B(t,s)});_scopeToLanguage(e){return this._embeddedLanguagesMatcher.match(e)||0}_toStandardTokenType(e){let t=e.match(r.STANDARD_TOKEN_TYPE_REGEXP);if(!t)return 8;switch(t[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"meta.embedded":return 0}throw new Error("Unexpected match for standard token type!")}static STANDARD_TOKEN_TYPE_REGEXP=/\b(comment|string|regex|meta\.embedded)\b/},pe=class{values;scopesRegExp;constructor(e){if(e.length===0)this.values=null,this.scopesRegExp=null;else{this.values=new Map(e);let t=e.map(([s,n])=>ke(s));t.sort(),t.reverse(),this.scopesRegExp=new RegExp(`^((${t.join(")|(")}))($|\\.)`,"")}}match(e){if(!this.scopesRegExp)return;let t=e.match(this.scopesRegExp);if(t)return this.values.get(t[1])}},Y=class{stack;stoppedEarly;constructor(e,t){this.stack=e,this.stoppedEarly=t}};function Oe(r,e,t,s,n,i,a,l){let o=e.content.length,c=!1,h=-1;if(a){let d=Ye(r,e,t,s,n,i);n=d.stack,s=d.linePos,t=d.isFirstLine,h=d.anchorPosition}let u=Date.now();for(;!c;){if(l!==0&&Date.now()-u>l)return new Y(n,!0);f()}return new Y(n,!1);function f(){let d=He(r,e,t,s,n,h);if(!d){i.produce(n,o),c=!0;return}let p=d.captureIndices,S=d.matchedRuleId,_=p&&p.length>0?p[0].end>s:!1;if(S===We){let C=n.getRule(r);i.produce(n,p[0].start),n=n.withContentNameScopesList(n.nameScopesList),L(r,e,t,n,i,C.endCaptures,p),i.produce(n,p[0].end);let g=n;if(n=n.parent,h=g.getAnchorPos(),!_&&g.getEnterPos()===s){n=g,i.produce(n,o),c=!0;return}}else{let C=r.getRule(S);i.produce(n,p[0].start);let g=n,w=C.getName(e.content,p),y=n.contentNameScopesList.pushAttributed(w,r);if(n=n.push(S,s,h,p[0].end===o,null,y,y),C instanceof T){let R=C;L(r,e,t,n,i,R.beginCaptures,p),i.produce(n,p[0].end),h=p[0].end;let G=R.getContentName(e.content,p),Q=y.pushAttributed(G,r);if(n=n.withContentNameScopesList(Q),R.endHasBackReferences&&(n=n.withEndRule(R.getEndWithResolvedBackReferences(e.content,p))),!_&&g.hasSameRuleAs(n)){n=n.pop(),i.produce(n,o),c=!0;return}}else if(C instanceof F){let R=C;L(r,e,t,n,i,R.beginCaptures,p),i.produce(n,p[0].end),h=p[0].end;let G=R.getContentName(e.content,p),Q=y.pushAttributed(G,r);if(n=n.withContentNameScopesList(Q),R.whileHasBackReferences&&(n=n.withEndRule(R.getWhileWithResolvedBackReferences(e.content,p))),!_&&g.hasSameRuleAs(n)){n=n.pop(),i.produce(n,o),c=!0;return}}else if(L(r,e,t,n,i,C.captures,p),i.produce(n,p[0].end),n=n.pop(),!_){n=n.safePop(),i.produce(n,o),c=!0;return}}p[0].end>s&&(s=p[0].end,t=!1)}}function Ye(r,e,t,s,n,i){let a=n.beginRuleCapturedEOL?0:-1,l=[];for(let o=n;o;o=o.pop()){let c=o.getRule(r);c instanceof F&&l.push({rule:c,stack:o})}for(let o=l.pop();o;o=l.pop()){let{ruleScanner:c,findOptions:h}=Ve(o.rule,r,o.stack.endRule,t,s===a),u=c.findNextMatchSync(e,s,h);if(u){if(u.ruleId!==Le){n=o.stack.pop();break}u.captureIndices&&u.captureIndices.length&&(i.produce(o.stack,u.captureIndices[0].start),L(r,e,t,o.stack,i,o.rule.whileCaptures,u.captureIndices),i.produce(o.stack,u.captureIndices[0].end),a=u.captureIndices[0].end,u.captureIndices[0].end>s&&(s=u.captureIndices[0].end,t=!1))}else{n=o.stack.pop();break}}return{stack:n,linePos:s,anchorPosition:a,isFirstLine:t}}function He(r,e,t,s,n,i){let a=Qe(r,e,t,s,n,i),l=r.getInjections();if(l.length===0)return a;let o=Xe(l,r,e,t,s,n,i);if(!o)return a;if(!a)return o;let c=a.captureIndices[0].start,h=o.captureIndices[0].start;return h<c||o.priorityMatch&&h===c?o:a}function Qe(r,e,t,s,n,i){let a=n.getRule(r),{ruleScanner:l,findOptions:o}=Be(a,r,n.endRule,t,s===i),c=l.findNextMatchSync(e,s,o);return c?{captureIndices:c.captureIndices,matchedRuleId:c.ruleId}:null}function Xe(r,e,t,s,n,i,a){let l=Number.MAX_VALUE,o=null,c,h=0,u=i.contentNameScopesList.getScopeNames();for(let f=0,d=r.length;f<d;f++){let p=r[f];if(!p.matcher(u))continue;let S=e.getRule(p.ruleId),{ruleScanner:_,findOptions:C}=Be(S,e,null,s,n===a),g=_.findNextMatchSync(t,n,C);if(!g)continue;let w=g.captureIndices[0].start;if(!(w>=l)&&(l=w,o=g.captureIndices,c=g.ruleId,h=p.priority,l===n))break}return o?{priorityMatch:h===-1,captureIndices:o,matchedRuleId:c}:null}function Be(r,e,t,s,n){return{ruleScanner:r.compileAG(e,t,s,n),findOptions:0}}function Ve(r,e,t,s,n){return{ruleScanner:r.compileWhileAG(e,t,s,n),findOptions:0}}function L(r,e,t,s,n,i,a){if(i.length===0)return;let l=e.content,o=Math.min(i.length,a.length),c=[],h=a[0].end;for(let u=0;u<o;u++){let f=i[u];if(f===null)continue;let d=a[u];if(d.length===0)continue;if(d.start>h)break;for(;c.length>0&&c[c.length-1].endPos<=d.start;)n.produceFromScopes(c[c.length-1].scopes,c[c.length-1].endPos),c.pop();if(c.length>0?n.produceFromScopes(c[c.length-1].scopes,d.start):n.produce(s,d.start),f.retokenizeCapturedWithRuleId){let S=f.getName(l,a),_=s.contentNameScopesList.pushAttributed(S,r),C=f.getContentName(l,a),g=_.pushAttributed(C,r),w=s.push(f.retokenizeCapturedWithRuleId,d.start,-1,!1,null,_,g),y=r.createOnigString(l.substring(0,d.end));Oe(r,y,t&&d.start===0,d.start,w,n,!1,0),Pe(y);continue}let p=f.getName(l,a);if(p!==null){let _=(c.length>0?c[c.length-1].scopes:s.contentNameScopesList).pushAttributed(p,r);c.push(new de(_,d.end))}}for(;c.length>0;)n.produceFromScopes(c[c.length-1].scopes,c[c.length-1].endPos),c.pop()}var de=class{scopes;endPos;constructor(e,t){this.scopes=e,this.endPos=t}};function Je(r,e,t,s,n,i,a,l){return new fe(r,e,t,s,n,i,a,l)}function we(r,e,t,s,n){let i=$(e,H),a=U.getCompiledRuleId(t,s,n.repository);for(let l of i)r.push({debugSelector:e,matcher:l.matcher,ruleId:a,grammar:n,priority:l.priority})}function H(r,e){if(e.length<r.length)return!1;let t=0;return r.every(s=>{for(let n=t;n<e.length;n++)if(Ze(e[n],s))return t=n+1,!0;return!1})}function Ze(r,e){if(!r)return!1;if(r===e)return!0;let t=e.length;return r.length>t&&r.substr(0,t)===e&&r[t]==="."}var fe=class{_rootScopeName;balancedBracketSelectors;_onigLib;_rootId;_lastRuleId;_ruleId2desc;_includedGrammars;_grammarRepository;_grammar;_injections;_basicScopeAttributesProvider;_tokenTypeMatchers;get themeProvider(){return this._grammarRepository}constructor(e,t,s,n,i,a,l,o){if(this._rootScopeName=e,this.balancedBracketSelectors=a,this._onigLib=o,this._basicScopeAttributesProvider=new ue(s,n),this._rootId=-1,this._lastRuleId=0,this._ruleId2desc=[null],this._includedGrammars={},this._grammarRepository=l,this._grammar=Ae(t,null),this._injections=null,this._tokenTypeMatchers=[],i)for(let c of Object.keys(i)){let h=$(c,H);for(let u of h)this._tokenTypeMatchers.push({matcher:u.matcher,type:i[c]})}}dispose(){for(let e of this._ruleId2desc)e&&e.dispose()}createOnigScanner(e){return this._onigLib.createOnigScanner(e)}createOnigString(e){return this._onigLib.createOnigString(e)}getMetadataForScope(e){return this._basicScopeAttributesProvider.getBasicScopeAttributes(e)}_collectInjections(){let e={lookup:i=>i===this._rootScopeName?this._grammar:this.getExternalGrammar(i),injections:i=>this._grammarRepository.injections(i)},t=[],s=this._rootScopeName,n=e.lookup(s);if(n){let i=n.injections;if(i)for(let l in i)we(t,l,i[l],this,n);let a=this._grammarRepository.injections(s);a&&a.forEach(l=>{let o=this.getExternalGrammar(l);if(o){let c=o.injectionSelector;c&&we(t,c,o,this,o)}})}return t.sort((i,a)=>i.priority-a.priority),t}getInjections(){return this._injections===null&&(this._injections=this._collectInjections()),this._injections}registerRule(e){let t=++this._lastRuleId,s=e(t);return this._ruleId2desc[t]=s,s}getRule(e){return this._ruleId2desc[e]}getExternalGrammar(e,t){if(this._includedGrammars[e])return this._includedGrammars[e];if(this._grammarRepository){let s=this._grammarRepository.lookup(e);if(s)return this._includedGrammars[e]=Ae(s,t&&t.$base),this._includedGrammars[e]}}tokenizeLine(e,t,s=0){let n=this._tokenize(e,t,!1,s);return{tokens:n.lineTokens.getResult(n.ruleStack,n.lineLength),ruleStack:n.ruleStack,stoppedEarly:n.stoppedEarly}}tokenizeLine2(e,t,s=0){let n=this._tokenize(e,t,!0,s);return{tokens:n.lineTokens.getBinaryResult(n.ruleStack,n.lineLength),ruleStack:n.ruleStack,stoppedEarly:n.stoppedEarly}}_tokenize(e,t,s,n){this._rootId===-1&&(this._rootId=U.getCompiledRuleId(this._grammar.repository.$self,this,this._grammar.repository),this.getInjections());let i;if(!t||t===v.NULL){i=!0;let h=this._basicScopeAttributesProvider.getDefaultAttributes(),u=this.themeProvider.getDefaults(),f=k.set(0,h.languageId,h.tokenType,null,u.fontStyle,u.foregroundId,u.backgroundId),d=this.getRule(this._rootId).getName(null,null),p;d?p=A.createRootAndLookUpScopeName(d,f,this):p=A.createRoot("unknown",f),t=new v(null,this._rootId,-1,-1,!1,null,p,p)}else i=!1,t.reset();e=e+`
`;let a=this.createOnigString(e),l=a.content.length,o=new me(s,e,this._tokenTypeMatchers,this.balancedBracketSelectors),c=Oe(this,a,i,0,t,o,!0,n);return Pe(a),{lineLength:l,lineTokens:o,ruleStack:c.stack,stoppedEarly:c.stoppedEarly}}};function Ae(r,e){return r=xe(r),r.repository=r.repository||{},r.repository.$self={$vscodeTextmateLocation:r.$vscodeTextmateLocation,patterns:r.patterns,name:r.scopeName},r.repository.$base=e||r.repository.$self,r}var A=class r{parent;scopePath;tokenAttributes;static fromExtension(e,t){let s=e,n=e?.scopePath??null;for(let i of t)n=O.push(n,i.scopeNames),s=new r(s,n,i.encodedTokenAttributes);return s}static createRoot(e,t){return new r(null,new O(null,e),t)}static createRootAndLookUpScopeName(e,t,s){let n=s.getMetadataForScope(e),i=new O(null,e),a=s.themeProvider.themeMatch(i),l=r.mergeAttributes(t,n,a);return new r(null,i,l)}get scopeName(){return this.scopePath.scopeName}constructor(e,t,s){this.parent=e,this.scopePath=t,this.tokenAttributes=s}toString(){return this.getScopeNames().join(" ")}equals(e){return r.equals(this,e)}static equals(e,t){do{if(e===t||!e&&!t)return!0;if(!e||!t||e.scopeName!==t.scopeName||e.tokenAttributes!==t.tokenAttributes)return!1;e=e.parent,t=t.parent}while(!0)}static mergeAttributes(e,t,s){let n=-1,i=0,a=0;return s!==null&&(n=s.fontStyle,i=s.foregroundId,a=s.backgroundId),k.set(e,t.languageId,t.tokenType,null,n,i,a)}pushAttributed(e,t){if(e===null)return this;if(e.indexOf(" ")===-1)return r._pushAttributed(this,e,t);let s=e.split(/ /g),n=this;for(let i of s)n=r._pushAttributed(n,i,t);return n}static _pushAttributed(e,t,s){let n=s.getMetadataForScope(t),i=e.scopePath.push(t),a=s.themeProvider.themeMatch(i),l=r.mergeAttributes(e.tokenAttributes,n,a);return new r(e,i,l)}getScopeNames(){return this.scopePath.getSegments()}getExtensionIfDefined(e){let t=[],s=this;for(;s&&s!==e;)t.push({encodedTokenAttributes:s.tokenAttributes,scopeNames:s.scopePath.getExtensionIfDefined(s.parent?.scopePath??null)}),s=s.parent;return s===e?t.reverse():void 0}},v=class r{parent;ruleId;beginRuleCapturedEOL;endRule;nameScopesList;contentNameScopesList;_stackElementBrand=void 0;static NULL=new r(null,0,0,0,!1,null,null,null);_enterPos;_anchorPos;depth;constructor(e,t,s,n,i,a,l,o){this.parent=e,this.ruleId=t,this.beginRuleCapturedEOL=i,this.endRule=a,this.nameScopesList=l,this.contentNameScopesList=o,this.depth=this.parent?this.parent.depth+1:1,this._enterPos=s,this._anchorPos=n}equals(e){return e===null?!1:r._equals(this,e)}static _equals(e,t){return e===t?!0:this._structuralEquals(e,t)?A.equals(e.contentNameScopesList,t.contentNameScopesList):!1}static _structuralEquals(e,t){do{if(e===t||!e&&!t)return!0;if(!e||!t||e.depth!==t.depth||e.ruleId!==t.ruleId||e.endRule!==t.endRule)return!1;e=e.parent,t=t.parent}while(!0)}clone(){return this}static _reset(e){for(;e;)e._enterPos=-1,e._anchorPos=-1,e=e.parent}reset(){r._reset(this)}pop(){return this.parent}safePop(){return this.parent?this.parent:this}push(e,t,s,n,i,a,l){return new r(this,e,t,s,n,i,a,l)}getEnterPos(){return this._enterPos}getAnchorPos(){return this._anchorPos}getRule(e){return e.getRule(this.ruleId)}toString(){let e=[];return this._writeString(e,0),"["+e.join(",")+"]"}_writeString(e,t){return this.parent&&(t=this.parent._writeString(e,t)),e[t++]=`(${this.ruleId}, ${this.nameScopesList?.toString()}, ${this.contentNameScopesList?.toString()})`,t}withContentNameScopesList(e){return this.contentNameScopesList===e?this:this.parent.push(this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,this.endRule,this.nameScopesList,e)}withEndRule(e){return this.endRule===e?this:new r(this.parent,this.ruleId,this._enterPos,this._anchorPos,this.beginRuleCapturedEOL,e,this.nameScopesList,this.contentNameScopesList)}hasSameRuleAs(e){let t=this;for(;t&&t._enterPos===e._enterPos;){if(t.ruleId===e.ruleId)return!0;t=t.parent}return!1}toStateStackFrame(){return{ruleId:this.ruleId,beginRuleCapturedEOL:this.beginRuleCapturedEOL,endRule:this.endRule,nameScopesList:this.nameScopesList?.getExtensionIfDefined(this.parent?.nameScopesList??null)??[],contentNameScopesList:this.contentNameScopesList?.getExtensionIfDefined(this.nameScopesList)??[]}}static pushFrame(e,t){let s=A.fromExtension(e?.nameScopesList??null,t.nameScopesList);return new r(e,t.ruleId,t.enterPos??-1,t.anchorPos??-1,t.beginRuleCapturedEOL,t.endRule,s,A.fromExtension(s,t.contentNameScopesList))}},_e=class{balancedBracketScopes;unbalancedBracketScopes;allowAny=!1;constructor(e,t){this.balancedBracketScopes=e.flatMap(s=>s==="*"?(this.allowAny=!0,[]):$(s,H).map(n=>n.matcher)),this.unbalancedBracketScopes=t.flatMap(s=>$(s,H).map(n=>n.matcher))}get matchesAlways(){return this.allowAny&&this.unbalancedBracketScopes.length===0}get matchesNever(){return this.balancedBracketScopes.length===0&&!this.allowAny}match(e){for(let t of this.unbalancedBracketScopes)if(t(e))return!1;for(let t of this.balancedBracketScopes)if(t(e))return!0;return this.allowAny}},me=class{balancedBracketSelectors;_emitBinaryTokens;_lineText;_tokens;_binaryTokens;_lastTokenEndIndex;_tokenTypeOverrides;constructor(e,t,s,n){this.balancedBracketSelectors=n,this._emitBinaryTokens=e,this._tokenTypeOverrides=s,this._lineText=null,this._tokens=[],this._binaryTokens=[],this._lastTokenEndIndex=0}produce(e,t){this.produceFromScopes(e.contentNameScopesList,t)}produceFromScopes(e,t){if(this._lastTokenEndIndex>=t)return;if(this._emitBinaryTokens){let n=e?.tokenAttributes??0,i=!1;if(this.balancedBracketSelectors?.matchesAlways&&(i=!0),this._tokenTypeOverrides.length>0||this.balancedBracketSelectors&&!this.balancedBracketSelectors.matchesAlways&&!this.balancedBracketSelectors.matchesNever){let a=e?.getScopeNames()??[];for(let l of this._tokenTypeOverrides)l.matcher(a)&&(n=k.set(n,0,l.type,null,-1,0,0));this.balancedBracketSelectors&&(i=this.balancedBracketSelectors.match(a))}if(i&&(n=k.set(n,0,8,i,-1,0,0)),this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-1]===n){this._lastTokenEndIndex=t;return}this._binaryTokens.push(this._lastTokenEndIndex),this._binaryTokens.push(n),this._lastTokenEndIndex=t;return}let s=e?.getScopeNames()??[];this._tokens.push({startIndex:this._lastTokenEndIndex,endIndex:t,scopes:s}),this._lastTokenEndIndex=t}getResult(e,t){return this._tokens.length>0&&this._tokens[this._tokens.length-1].startIndex===t-1&&this._tokens.pop(),this._tokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(e,t),this._tokens[this._tokens.length-1].startIndex=0),this._tokens}getBinaryResult(e,t){this._binaryTokens.length>0&&this._binaryTokens[this._binaryTokens.length-2]===t-1&&(this._binaryTokens.pop(),this._binaryTokens.pop()),this._binaryTokens.length===0&&(this._lastTokenEndIndex=-1,this.produce(e,t),this._binaryTokens[this._binaryTokens.length-2]=0);let s=new Uint32Array(this._binaryTokens.length);for(let n=0,i=this._binaryTokens.length;n<i;n++)s[n]=this._binaryTokens[n];return s}},ge=class{_onigLibPromise;_grammars=new Map;_rawGrammars=new Map;_injectionGrammars=new Map;_theme;constructor(e,t){this._onigLibPromise=t,this._theme=e}dispose(){for(let e of this._grammars.values())e.dispose()}setTheme(e){this._theme=e}getColorMap(){return this._theme.getColorMap()}addGrammar(e,t){this._rawGrammars.set(e.scopeName,e),t&&this._injectionGrammars.set(e.scopeName,t)}lookup(e){return this._rawGrammars.get(e)}injections(e){return this._injectionGrammars.get(e)}getDefaults(){return this._theme.getDefaults()}themeMatch(e){return this._theme.match(e)}async grammarForScopeName(e,t,s,n,i){if(!this._grammars.has(e)){let a=this._rawGrammars.get(e);if(!a)return null;this._grammars.set(e,Je(e,a,t,s,n,i,this,await this._onigLibPromise))}return this._grammars.get(e)}},tt=class{_options;_syncRegistry;_ensureGrammarCache;constructor(e){this._options=e,this._syncRegistry=new ge(M.createFromRawTheme(e.theme,e.colorMap),e.onigLib),this._ensureGrammarCache=new Map}dispose(){this._syncRegistry.dispose()}setTheme(e,t){this._syncRegistry.setTheme(M.createFromRawTheme(e,t))}getColorMap(){return this._syncRegistry.getColorMap()}loadGrammarWithEmbeddedLanguages(e,t,s){return this.loadGrammarWithConfiguration(e,t,{embeddedLanguages:s})}loadGrammarWithConfiguration(e,t,s){return this._loadGrammar(e,t,s.embeddedLanguages,s.tokenTypes,new _e(s.balancedBracketSelectors||[],s.unbalancedBracketSelectors||[]))}loadGrammar(e){return this._loadGrammar(e,0,null,null,null)}async _loadGrammar(e,t,s,n,i){let a=new Z(this._syncRegistry,e);for(;a.Q.length>0;)await Promise.all(a.Q.map(l=>this._loadSingleGrammar(l.scopeName))),a.processQueue();return this._grammarForScopeName(e,t,s,n,i)}async _loadSingleGrammar(e){return this._ensureGrammarCache.has(e)||this._ensureGrammarCache.set(e,this._doLoadSingleGrammar(e)),this._ensureGrammarCache.get(e)}async _doLoadSingleGrammar(e){let t=await this._options.loadGrammar(e);if(t){let s=typeof this._options.getInjections=="function"?this._options.getInjections(e):void 0;this._syncRegistry.addGrammar(t,s)}}async addGrammar(e,t=[],s=0,n=null){return this._syncRegistry.addGrammar(e,t),await this._grammarForScopeName(e.scopeName,s,n)}_grammarForScopeName(e,t=0,s=null,n=null,i=null){return this._syncRegistry.grammarForScopeName(e,t,s,n,i)}},nt=v.NULL,m={LANGUAGEID_MASK:255,TOKEN_TYPE_MASK:768,BALANCED_BRACKETS_MASK:1024,FONT_STYLE_MASK:14336,FOREGROUND_MASK:8372224,BACKGROUND_MASK:4286578688,LANGUAGEID_OFFSET:0,TOKEN_TYPE_OFFSET:8,BALANCED_BRACKETS_OFFSET:10,FONT_STYLE_OFFSET:11,FOREGROUND_OFFSET:15,BACKGROUND_OFFSET:24},Ie=class r{static toBinaryStr(e){let t=e.toString(2);for(;t.length<32;)t=`0${t}`;return t}static getLanguageId(e){return(e&m.LANGUAGEID_MASK)>>>m.LANGUAGEID_OFFSET}static getTokenType(e){return(e&m.TOKEN_TYPE_MASK)>>>m.TOKEN_TYPE_OFFSET}static getFontStyle(e){return(e&m.FONT_STYLE_MASK)>>>m.FONT_STYLE_OFFSET}static getForeground(e){return(e&m.FOREGROUND_MASK)>>>m.FOREGROUND_OFFSET}static getBackground(e){return(e&m.BACKGROUND_MASK)>>>m.BACKGROUND_OFFSET}static containsBalancedBrackets(e){return(e&m.BALANCED_BRACKETS_MASK)!==0}static set(e,t,s,n,i,a){let l=r.getLanguageId(e),o=r.getTokenType(e),c=r.getFontStyle(e),h=r.getForeground(e),u=r.getBackground(e),f=r.containsBalancedBrackets(e)?1:0;return t!==0&&(l=t),s!==0&&(o=s===8?0:s),n!==Te.NotSet&&(c=n),i!==0&&(h=i),a!==0&&(u=a),(l<<m.LANGUAGEID_OFFSET|o<<m.TOKEN_TYPE_OFFSET|c<<m.FONT_STYLE_OFFSET|f<<m.BALANCED_BRACKETS_OFFSET|h<<m.FOREGROUND_OFFSET|u<<m.BACKGROUND_OFFSET)>>>0}};export{nt as INITIAL,tt as Registry,Ie as StackElementMetadata,M as Theme};
//# sourceMappingURL=textmate.js.map