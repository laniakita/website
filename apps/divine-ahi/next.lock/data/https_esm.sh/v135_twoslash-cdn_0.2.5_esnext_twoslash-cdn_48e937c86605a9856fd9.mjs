/* esm.sh - esbuild bundle(twoslash-cdn@0.2.5) esnext production */
import __Process$ from "/v135/node_process.js";
import{createTwoslasher as L}from"/v135/twoslash@0.2.5/esnext/twoslash.mjs";import*as T from"/v135/typescript@5.4.3/esnext/lib/tsserverlibrary.js";var W=!1;try{W=typeof localStorage<"u"}catch{}var G=typeof __Process$<"u";W&&localStorage.getItem("DEBUG")||G&&__Process$.env.DEBUG;var U=function(s,t){var n=s.target||t.ScriptTarget.ES5,o=s.lib||[],r=["lib.d.ts","lib.decorators.d.ts","lib.decorators.legacy.d.ts","lib.dom.d.ts","lib.dom.iterable.d.ts","lib.webworker.d.ts","lib.webworker.importscripts.d.ts","lib.webworker.iterable.d.ts","lib.scripthost.d.ts","lib.es5.d.ts","lib.es6.d.ts","lib.es2015.collection.d.ts","lib.es2015.core.d.ts","lib.es2015.d.ts","lib.es2015.generator.d.ts","lib.es2015.iterable.d.ts","lib.es2015.promise.d.ts","lib.es2015.proxy.d.ts","lib.es2015.reflect.d.ts","lib.es2015.symbol.d.ts","lib.es2015.symbol.wellknown.d.ts","lib.es2016.array.include.d.ts","lib.es2016.d.ts","lib.es2016.full.d.ts","lib.es2017.d.ts","lib.es2017.date.d.ts","lib.es2017.full.d.ts","lib.es2017.intl.d.ts","lib.es2017.object.d.ts","lib.es2017.sharedmemory.d.ts","lib.es2017.string.d.ts","lib.es2017.typedarrays.d.ts","lib.es2018.asyncgenerator.d.ts","lib.es2018.asynciterable.d.ts","lib.es2018.d.ts","lib.es2018.full.d.ts","lib.es2018.intl.d.ts","lib.es2018.promise.d.ts","lib.es2018.regexp.d.ts","lib.es2019.array.d.ts","lib.es2019.d.ts","lib.es2019.full.d.ts","lib.es2019.intl.d.ts","lib.es2019.object.d.ts","lib.es2019.string.d.ts","lib.es2019.symbol.d.ts","lib.es2020.bigint.d.ts","lib.es2020.d.ts","lib.es2020.date.d.ts","lib.es2020.full.d.ts","lib.es2020.intl.d.ts","lib.es2020.number.d.ts","lib.es2020.promise.d.ts","lib.es2020.sharedmemory.d.ts","lib.es2020.string.d.ts","lib.es2020.symbol.wellknown.d.ts","lib.es2021.d.ts","lib.es2021.full.d.ts","lib.es2021.intl.d.ts","lib.es2021.promise.d.ts","lib.es2021.string.d.ts","lib.es2021.weakref.d.ts","lib.es2022.array.d.ts","lib.es2022.d.ts","lib.es2022.error.d.ts","lib.es2022.full.d.ts","lib.es2022.intl.d.ts","lib.es2022.object.d.ts","lib.es2022.regexp.d.ts","lib.es2022.sharedmemory.d.ts","lib.es2022.string.d.ts","lib.es2023.array.d.ts","lib.es2023.collection.d.ts","lib.es2023.d.ts","lib.es2023.full.d.ts","lib.esnext.array.d.ts","lib.esnext.asynciterable.d.ts","lib.esnext.bigint.d.ts","lib.esnext.d.ts","lib.esnext.decorators.d.ts","lib.esnext.disposable.d.ts","lib.esnext.full.d.ts","lib.esnext.intl.d.ts","lib.esnext.promise.d.ts","lib.esnext.string.d.ts","lib.esnext.symbol.d.ts","lib.esnext.weakref.d.ts"],l=t.ScriptTarget[n],a=r.filter(function(p){return p.startsWith("lib."+l.toLowerCase())}),d=r.indexOf(a.pop()),c=function(g){return g&&g.length?g.reduce(function(v,w){return w>v?w:v}):void 0},b=o.map(function(p){var g=r.filter(function(w){return w.startsWith("lib."+p.toLowerCase())});if(g.length===0)return 0;var v=r.indexOf(g.pop());return v}),u=c(b)||0,m=Math.max(d,u);return r.slice(0,m+1)},B=function(s,t,n,o,r,l,a){var d=l||fetch,c=new Map,b=U(s,o),u="https://typescript.azureedge.net/cdn/"+t+"/typescript/lib/";function m(f){return r?r.compressToUTF16(f):f}function p(f){return r?r.decompressFromUTF16(f):f}function g(){return Promise.all(b.map(function(f){return d(u+f).then(function(M){return M.text()})})).then(function(f){f.forEach(function(M,h){return c.set("/"+b[h],M)})}).catch(function(){})}function v(){var f=a||localStorage,M=Object.keys(f);return M.forEach(function(h){h.startsWith("ts-lib-")&&!h.startsWith("ts-lib-"+t)&&f.removeItem(h)}),Promise.all(b.map(function(h){var F="ts-lib-"+t+"-"+h,x=f.getItem(F);return x?Promise.resolve(p(x)):d(u+h).then(function(y){return y.text()}).then(function(y){return f.setItem(F,m(y)),y}).catch(function(){})})).then(function(h){h.forEach(function(F,x){if(F){var y="/"+b[x];c.set(y,F)}})})}var w=n?v:g;return w().then(function(){return c})},K=Object.defineProperty,q=Object.defineProperties,z=Object.getOwnPropertyDescriptors,C=Object.getOwnPropertySymbols,A=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,j=(e,s,t)=>s in e?K(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,V=(e,s)=>{for(var t in s||(s={}))A.call(s,t)&&j(e,t,s[t]);if(C)for(var t of C(s))H.call(s,t)&&j(e,t,s[t]);return e},R=(e,s)=>q(e,z(s)),$=(e,s,t)=>new Promise((n,o)=>{var r=d=>{try{a(t.next(d))}catch(c){o(c)}},l=d=>{try{a(t.throw(d))}catch(c){o(c)}},a=d=>d.done?n(d.value):Promise.resolve(d.value).then(r,l);a((t=t.apply(e,s)).next())}),J=(e,s)=>{let t=`https://data.jsdelivr.com/v1/package/npm/${s}`;return k(e,t,{cache:"no-store"})},Q=(e,s,t)=>{let n=`https://data.jsdelivr.com/v1/package/resolve/npm/${s}@${t}`;return k(e,n)},X=(e,s,t)=>$(void 0,null,function*(){let n=`https://data.jsdelivr.com/v1/package/npm/${s}@${t}/flat`,o=yield k(e,n);return o instanceof Error?o:R(V({},o),{moduleName:s,version:t})}),E=(e,s,t,n)=>$(void 0,null,function*(){let o=`https://cdn.jsdelivr.net/npm/${s}@${t}${n}`,l=yield(e.fetcher||fetch)(o);return l.ok?l.text():new Error("OK")});function k(e,s,t){return(e.fetcher||fetch)(s,t).then(o=>o.ok?o.json().then(r=>r):new Error("OK"))}var Y=e=>{if(["assert","assert/strict","async_hooks","buffer","child_process","cluster","console","constants","crypto","dgram","diagnostics_channel","dns","dns/promises","domain","events","fs","fs/promises","http","http2","https","inspector","module","net","os","path","path/posix","path/win32","perf_hooks","process","punycode","querystring","readline","repl","stream","stream/promises","stream/consumers","stream/web","string_decoder","sys","timers","timers/promises","tls","trace_events","tty","url","util","util/types","v8","vm","wasi","worker_threads","zlib"].includes(e.replace("node:","")))return"node";let[t="",n=""]=e.split("/");return t.startsWith("@")?`${t}/${n}`:t},Z=e=>{let s=new Map,t=new Map,n=0,o=0;return l=>(n=0,o=0,r(l,0).then(a=>{var d,c;o>0&&((c=(d=e.delegate).finished)==null||c.call(d,t))}));function r(l,a){return $(this,null,function*(){var d,c,b,u,m;let p=te(e,s,l);p.forEach(i=>s.set(i.module,{state:"loading"}));let v=(yield Promise.all(p.map(i=>I(e,i.module,i.version)))).filter(i=>!("error"in i)),w=v.filter(i=>i.files.find(_=>_.name.endsWith(".d.ts"))),f=w.map(i=>S(i,`/node_modules/${i.moduleName}`)),M=v.filter(i=>!w.includes(i)),F=(yield Promise.all(M.map(i=>I(e,`@types/${D(i.moduleName)}`,"latest")))).filter(i=>!("error"in i)),x=F.map(i=>S(i,`/node_modules/@types/${D(i.moduleName).replace("types__","")}`)),y=f.concat(x).reduce((i,_)=>i.concat(_),[]);n+=y.length,y.length&&a===0&&((c=(d=e.delegate).started)==null||c.call(d));for(let i of v){let _=`/node_modules/${i.moduleName}`;F.includes(i)&&(_=`/node_modules/@types/${D(i.moduleName).replace("types__","")}`);let P=_+"/package.json",O=yield E(e,i.moduleName,i.version,"/package.json");typeof O=="string"?(t.set(P,O),(u=(b=e.delegate).receivedFile)==null||u.call(b,O,P)):(m=e.logger)==null||m.error(`Could not download package.json for ${i.moduleName}`)}yield Promise.all(y.map(i=>$(this,null,function*(){var _,P,O;let N=yield E(e,i.moduleName,i.moduleVersion,i.path);o++,N instanceof Error?(_=e.logger)==null||_.error(`Had an issue getting ${i.path} for ${i.moduleName}`):(t.set(i.vfsPath,N),(O=(P=e.delegate).receivedFile)==null||O.call(P,N,i.vfsPath),e.delegate.progress&&o%5===0&&e.delegate.progress(o,n),yield r(N,a+1))})))})}};function S(e,s){let t=[];for(let n of e.files)n.name.endsWith(".d.ts")&&t.push({moduleName:e.moduleName,moduleVersion:e.version,vfsPath:`${s}${n.name}`,path:n.name});return t}var ee=(e,s)=>{let t=e.preProcessFile(s),n=e.libMap||new Map;return t.referencedFiles.concat(t.importedFiles).concat(t.libReferenceDirectives).filter(r=>!r.fileName.endsWith(".d.ts")).filter(r=>!n.has(r.fileName)).map(r=>{let l;if(!r.fileName.startsWith(".")){l="latest";let a=s.slice(r.end).split(`
`)[0];a.includes("// types:")&&(l=a.split("// types: ")[1].trim())}return{module:r.fileName,version:l}})};function te(e,s,t){return ee(e.typescript,t).map(r=>R(V({},r),{module:Y(r.module)})).filter(r=>!r.module.startsWith(".")).filter(r=>!s.has(r.module))}var I=(e,s,t)=>$(void 0,null,function*(){let n=t||"latest";if(n.split(".").length<2){let r=yield Q(e,s,n);if(r instanceof Error)return{error:r,userFacingMessage:`Could not go from a tag to version on npm for ${s} - possible typo?`};let l=r.version;if(!l){let a=yield J(e,s);if(a instanceof Error)return{error:r,userFacingMessage:`Could not get versions on npm for ${s} - possible typo?`};let d=Object.entries(a.tags).join(", ");return{error:new Error("Could not find tag for module"),userFacingMessage:`Could not find a tag for ${s} called ${t}. Did find ${d}`}}n=l}let o=yield X(e,s,n);return o instanceof Error?{error:o,userFacingMessage:`Could not get the files for ${s}@${n}. Is it possibly a typo?`}:o});function D(e){return e.indexOf("@")===0&&e.indexOf("/")!==-1&&(e=e.substr(1).replace("/","__")),e}function ne(e={}){let s=e.storage?se(e.storage,e.fetcher||fetch):e.fetcher||fetch,t=e.fsMap||new Map,n;async function o(){(await B(e.compilerOptions||{},T.version,!1,T,void 0,s)).forEach((m,p)=>{t.set(p,m)})}function r(){return n||(n=o()),n}let l=Z({projectName:"twoslash-cdn",typescript:T,fetcher:s,delegate:{receivedFile:(u,m)=>{t.set(m,u)}}});async function a(u){await Promise.all([r(),l(u)])}let d=L({...e.twoSlashOptionsOverrides,tsModule:T,fsMap:t});async function c(u,m,p){return await a(u),b(u,m,p)}function b(u,m,p){return d(u,m,{...e.twoSlashOptionsOverrides,...p})}return{run:c,runSync:b,init:r,prepareTypes:a,fetcher:s}}function se(e,s=fetch){return async(t,n)=>{let o=!n||n?.method==="GET"&&n?.cache!=="no-store",r=o?await e.getItemRaw(t):void 0;if(r!=null)return new Response(r,n);{let l=await s(t,n);return o&&l.clone().text().then(a=>e.setItemRaw(t,a)),l}}}export{se as createCachedFetchFromStorage,ne as createTwoslashFromCDN};
//# sourceMappingURL=twoslash-cdn.mjs.map